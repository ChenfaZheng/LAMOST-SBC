# 基于恒星的LAMOST光谱定标

借鉴北师大苑海波教授等人提出的方法，使用恒星光谱对LAMOST进行定标

参见：
- Yang Sun et al 2021 Res. Astron. Astrophys. 21 092
- Hai-Bo Yuan et al 2021 Res. Astron. Astrophys. 21 074

## 方法简介

综述：通过对大量恒星光谱不同波长的片段借助模板谱测出的视向速度与LAMOST发布的星表中的视向速度对比，检查LAMOST光谱波长定标可能存在的偏差

方法：

1. 对每一个恒星光谱，通过其`obsid`在LAMOST AFGK恒星参数星表中查找其通过LASP测得的金属丰度`feh`、alpha元素丰度`alpha_m`、有效温度`teff`、表面重力`logg`、日心视向速度`rv`（参见[文档](https://dr7.lamost.org/v2.0/doc/lr-data-production-description_cn#s3.2)），并假定其碳元素丰度`carbon`为0（因LAMOST星表、恒星光谱文件中均未给出测量值），仪器致宽`ins`指定为1800km/s。

2. 将上述参数根据Bohlin et al. 2017, AJ, 153, 234的算法，找到最接近的模板参数，下载并得到模板谱

3. 对恒星谱和模板谱分别进行归一化。归一化：先通过滑动平均得到光谱的连续谱成分，然后用光谱的流量除以滑动平均的流量，得到的相对值为归一化的光谱；这里滑动平均的窗口为51个像素

4. 将模板谱赋予从-1000km/s到+1000km/s步长为5的视向速度，得到401个平移后的模板谱

5. 将恒星谱和401个模板谱均裁剪出波长3900埃到9100埃的部分，分别进行线性插值（`scipy.interpolate.interp1d`）

6. 考虑从4000埃到9000埃宽度为500埃的10个片段，以1埃为步长对每个片段对应的恒星谱和401个模板谱根据线性插值的结果进行重采样

7. 对重采样后的每个片段，用恒星谱对401个模板谱计算pearson相关系数，在模板速度-相关系数空间中寻找相关系数极大值对应的模板速度，视为该片段基于恒星模板谱得到的视向速度

8. 将每个片段得到的视向速度与LAMOST AFGK星表中读到的日心视向速度进行比较（如做差），分析差异关于光纤编号等变量是否相关


## 程序运行方法

执行`python main.py --config <config_file>`，如不指定`<config_file>`，默认读取同目录下`config.yaml`

## 运行环境

使用Python3.10开发，用Pipenv进行环境管理

安装虚拟环境，在根目录执行`pipenv install`；进入虚拟环境，在根目录执行`pipenv shell`，退出执行`exit`

## 开源许可

MIT